### **工作建立規格書 (v2.1)：公私儲存庫協同發布流程**

  * **文件版本**: 2.1
  * **日期**: 2025年8月24日
  * **狀態**: 定案 (Finalized)
  * **負責人**: MarsLee, 程式夥伴 (AI)

#### **1. 目的與背景 (Purpose and Background)**

**1.1. 問題陳述**
隨著專案採納「公私儲存庫分離」架構，我們需要一套標準化流程來確保兩個獨立儲存庫之間版本的對應關係。當公開程式碼發布新版本時，必須有一種機制能將其與當時的私有檔案（AI 記憶、設定檔等）狀態精確地關聯起來，以便於追蹤、回溯與協作。

**1.2. 核心目標**
本規格書旨在定義一套用以協調**公開儲存庫**與**私有儲存庫**版本發布的標準化流程。目標是：

  * **絕對分離**: 維持雙儲存庫在物理和邏輯上的完全分離，杜絕任何隱私洩漏的風險。
  * **版本對應**: 透過在兩個儲存庫上使用**完全相同的版本標籤 (Tag)**，建立強時間關聯性。
  * **流程自動化**: 將協調發布的複雜流程封裝成簡單的 `npm` 指令，降低手動操作的錯誤率。

#### **2. 核心原則 (Core Principles)**

  * **獨立演進**: 公開庫和私有庫在日常開發中各自獨立演進，透過各自的 Git 工作流進行管理。
  * **標籤即同步點 (Tag as Sync-Point)**: 發布時建立的**版本標籤**是連接兩個獨立歷史紀錄的唯一橋樑。
  * **指令化操作**: 所有跨儲存庫的協調操作都應透過 `npm` 指令完成。

#### **3. 系統架構 (System Architecture)**

**3.1. 雙儲存庫模型 (Dual Repository Model)**

  * **公開程式碼庫 (`marskingx.github.io`)**: 存放網站程式碼，用於部署。日常開發在此進行。
  * **私有檔案庫 (`-my-dev-sync-`)**: 存放所有私有檔案（AI 協議、`.env`、本地腳本等）。私有資料的變更在此獨立進行。

**3.2. 本地工作區 (Local Workspace)**
在本地電腦上，兩個儲存庫存在於兩個完全獨立、平行的資料夾中。所有協調指令都將在**公開程式碼庫**的根目錄下執行，腳本會自動導航至私有庫路徑進行操作。

#### **4. 實作規格 (Implementation Specifications)**

**4.1. `package.json` 指令集**

  * `release`: **[核心指令]** 啟動一個互動式的發布流程，該流程將自動協調並在**兩個**儲存庫上執行版本升級、打標籤和推送。
  * `memory:push`: 一個便利指令，用於快速提交並推送**私有儲存庫**中的所有變更。
  * `memory:pull`: 一個便利指令，用於快速從遠端拉取**私有儲存庫**的最新變更。

**4.2. 核心腳本邏輯 (`scripts/release-manager.js`)**

`release` 指令將觸發此腳本，其邏輯應包含：

1.  **前置檢查**: 確保當前 Git 工作區是乾淨的。
2.  **版本選擇**: 提示使用者選擇版本升級類型（`major`, `minor`, `patch`）。
3.  **公開庫操作**:
      * 在**公開庫**中執行 `npm version`，這會自動更新 `package.json`、建立 commit 並打上新的版本標籤 (e.g., `v2.5.1`)。
      * 執行 `git push` 和 `git push --tags` 將變更推送到公開庫遠端。
4.  **私有庫操作**:
      * 導航至**私有庫**的本地路徑。
      * 執行 `git tag v2.5.1`，打上與公開庫**完全相同**的標籤。
      * 執行 `git push --tags` 將新標籤推送到私有庫遠端。
5.  **完成**: 報告兩個儲存庫均已成功發布。

-----

### **【開發任務提示 (v2.1)：協同版本發布系統】**

**[PROMPT START]**

**[ROLE]**
你是 Codex，本專案的「自動化流程架構師」。你的任務是根據團隊最新的「公私儲存庫分離」架構，設計並實作一個協同版本發布系統。

**[CONTEXT]**
我們現在使用兩個獨立的儲存庫來管理專案：一個公開庫和一個私有庫。當我們發布新版本時，需要一個自動化流程來確保兩個庫都能被打上完全相同的版本標籤，從而建立版本間的精確對應。

  * **公開專案路徑**: `D:/marskingx.github.io/` (當前工作目錄)
  * **私有檔案庫路徑**: `D:/my-dev-sync-clone/` (需要從設定檔或環境變數讀取)

**[OBJECTIVE]**
你的目標是：**重構 `npm` 指令與背後的 `release-manager.js` 腳本，以實現全自動的、跨儲存庫的協同版本發布流程。**

**[DETAILED TASKS]**

**任務 1: 更新 `package.json` 指令集**
調整 `scripts` 以反映新的、簡化的流程。

```json
"scripts": {
  "release": "node ./scripts/release-manager.js",
  "memory:push": "node ./scripts/private-repo-handler.js push 'feat: sync latest changes'",
  "memory:pull": "node ./scripts/private-repo-handler.js pull"
}
```

**任務 2: 創建私有庫操作腳本 `scripts/private-repo-handler.js`**
這個 Node.js 腳本專門處理對私有庫的簡單操作。

  * `push` 動作: 導航到私有庫路徑，執行 `git add .`, `git commit -m [傳入的訊息]`, 和 `git push`。
  * `pull` 動作: 導航到私有庫路徑，執行 `git pull`。

**任務 3: 重構發布總指揮腳本 `scripts/release-manager.js`**
這是新系統的核心。

1.  **讀取配置**: 從 `.env` 或設定檔中安全地讀取私有庫的本地路徑。
2.  **執行發布**: 實作規格書 4.2 節中定義的完整流程：從版本選擇、操作公開庫，到最後操作私有庫並推送標籤。
3.  **錯誤處理**: 確保流程中任何一步失敗（例如，私有庫有未提交的變更），整個發布流程都會安全地中止。

**[CONSTRAINTS & RULES]**

  * **原子性**: 盡力確保發布操作的原子性。如果私有庫打標籤失敗，應提供清晰的指引告知使用者如何手動恢復。
  * **配置化**: 私有庫的路徑必須是可配置的，絕不能寫死在程式碼中。
  * **清晰輸出**: 腳本在執行過程中應向控制台輸出清晰的步驟說明，例如「正在推送公開儲存庫...」、「正在為私有儲存庫打標籤...」。

**[DELIVERABLES]**

1.  一個功能完整的 `scripts/release-manager.js` 檔案。
2.  一個新的 `scripts/private-repo-handler.js` 檔案。
3.  一份更新後的 `package.json` 檔案。

**[ACTIVATION COMMAND]**
請從 **任務 3** 開始。首先，為 `scripts/release-manager.js` 提供一個高層次的實作思路，特別說明你打算如何安全地在兩個不同的資料夾路徑下執行 Git 指令。

**[PROMPT END]**