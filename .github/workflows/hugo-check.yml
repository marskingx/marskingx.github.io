name: ðŸ” Hugo Build Check

on:
  # åªåœ¨ PR æ™‚è‡ªå‹•æª¢æŸ¥å»ºç½®æ˜¯å¦æˆåŠŸ
  pull_request:
    branches: [ main ]
  # ä¹Ÿå¯ä»¥æ‰‹å‹•è§¸ç™¼æª¢æŸ¥
  workflow_dispatch:

jobs:
  check:
    runs-on: ubuntu-latest
    env:
      HUGO_VERSION: 0.148.2
    steps:
      - name: ðŸ“¥ Checkout repository
        uses: actions/checkout@v4
        with:
          submodules: recursive

      - name: ðŸ“¦ Setup Hugo
        uses: peaceiris/actions-hugo@v3
        with:
          hugo-version: ${{ env.HUGO_VERSION }}
          extended: true

      - name: ðŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: ðŸ”§ Install dependencies
        run: |
          npm ci
          hugo mod get
          hugo mod tidy

      - name: ðŸ” Check Hugo configuration
        run: hugo config

      - name: ðŸ—ï¸ Test build (no deploy)
        run: |
          hugo --gc --minify --environment staging --baseURL "https://example.com"
          echo "âœ… å»ºç½®æ¸¬è©¦æˆåŠŸ - ç¶²ç«™å¯æ­£å¸¸å»ºç«‹" >> $GITHUB_STEP_SUMMARY

      - name: ðŸ“Š Build report
        run: |
          echo "## ðŸ“Š å»ºç½®æª¢æŸ¥å ±å‘Š" >> $GITHUB_STEP_SUMMARY
          echo "- **Hugo ç‰ˆæœ¬**: ${{ env.HUGO_VERSION }}" >> $GITHUB_STEP_SUMMARY
          echo "- **æª¢æŸ¥æ™‚é–“**: $(date -u '+%Y-%m-%d %H:%M:%S UTC')" >> $GITHUB_STEP_SUMMARY
          if [ -d "public" ]; then
            echo "- **é é¢æ•¸**: $(find public -name "*.html" | wc -l)" >> $GITHUB_STEP_SUMMARY
            echo "- **ç¸½æª”æ¡ˆæ•¸**: $(find public -type f | wc -l)" >> $GITHUB_STEP_SUMMARY
          fi
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "ðŸŽ‰ **å»ºç½®æª¢æŸ¥é€šéŽï¼** å¯ä»¥å®‰å…¨åˆä½µæ­¤ PRã€‚" >> $GITHUB_STEP_SUMMARY